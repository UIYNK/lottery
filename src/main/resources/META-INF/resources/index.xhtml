<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      dir="rtl"
      lang="fa">
<h:head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>قرعه‌کشی</title>
    <h:outputStylesheet library="css" name="primeIcons/primeicons.css"/>
    <h:outputStylesheet library="css" name="vazir.css"/>
    <h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css"/>
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif !important;
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
        }
    </style>
</h:head>
<h:body styleClass="pt-4">


    <h:form id="mainForm" styleClass="flex flex-column align-items-center">

        <h:outputText styleClass="text-5xl font-bold mb-8" value="#{eventState.currentEvent.title}"/>
        <div class="flex justify-between align-items-end gap-6 mb-8 grow-0">
            <div class="flex-grow-0">
                <p:outputLabel rendered="#{!eventState.finished}" for="numberSpinner" value="تعداد قرعه"/>
                <p:outputLabel rendered="#{eventState.finished}" value="جایزه ها به اتمام رسید" styleClass="text-3xl"/>
                <p:spinner id="numberSpinner" rendered="#{!eventState.finished}" value="#{eventState.toBePicked}"
                           min="1" decimalPlaces="0"
                           style="width: max-content"
                           dir="ltr" styleClass="mr-1"/>
            </div>

            <p:commandButton type="submit" rendered="#{!eventState.finished}" value="انتخاب شماره"
                             action="#{eventState.pick()}" update="mainForm"
                             styleClass="ui-button-raised"/>

            <p:commandButton value="از سر گیری" action="#{eventState.rest()}" update="mainForm"
                             styleClass="ui-button-danger mr-2" icon="pi pi-undo">
                <p:confirm header="تایید" message=" با تایید نتایج قرعه کشی پاک خواهد شد"
                           icon="pi pi-info-circle"/>
            </p:commandButton>
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="370">
                <p:commandButton value="انصراف" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
                <p:commandButton value="تایید" type="button" styleClass="ui-confirmdialog-yes"/>
            </p:confirmDialog>

        </div>
        <p:commandButton value="دانلود نتایج"
                         styleClass="rounded-button ui-button-secondary align-self-end mb-4 text-sm"
                         icon="pi pi-save">
            <p:dataExporter type="xlsxstream" target="picks" fileName="picks"/>
        </p:commandButton>

        <p:dataTable id="picks" var="lotteryPick" value="#{eventState.currentEventPicks}" rowIndexVar="index"
                     emptyMessage="هنوز قرعه کشی انجام نشده است"
                     scrollable="true"
                     scrollHeight="400"
                     exportTag=""
                     dir="rtl">
            <p:column headerText="ردیف" styleClass="w-fit">
                <h:outputText value="#{index+1}" lang="fa"/>
            </p:column>

            <p:column headerText="سریال قرعه کشی">
                <h:outputText value="#{lotteryPick.ticket.serialNumber}"/>
            </p:column>

            <p:column headerText="جایزه">
                <h:outputText value="#{lotteryPick.prize.title}"/>
            </p:column>
        </p:dataTable>
        <p:progressBar id="progressBarIndeterminate" style="height:6px" mode="indeterminate"/>
    </h:form>


</h:body>
</html>
